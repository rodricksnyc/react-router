{"version":3,"file":"userAttributeTransform.js","names":["updateAttributeValue","node","userAttributes","type","TYPE_USER_ATTRIBUTE","userAttribute","findUserAttribute","attributeName","attributeValue","value","userAttributeTransform","root","length","workingRoot","pointer","right","left"],"sources":["../../../../src/utils/transform/userAttributeTransform.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\nimport type { FilterASTNode, UserAttributeWithValue } from '../../types'\nimport { TYPE_USER_ATTRIBUTE } from '../../types'\nimport { findUserAttribute } from '../user_attribute'\n\n/**\n * sets the userAttributeValue on a node with type 'user_attribute'\n */\nconst updateAttributeValue = (\n  node: FilterASTNode,\n  userAttributes: UserAttributeWithValue[]\n): FilterASTNode => {\n  if (node && node.type === TYPE_USER_ATTRIBUTE) {\n    const userAttribute = findUserAttribute(node.attributeName, userAttributes)\n    return {\n      ...node,\n      attributeValue: userAttribute && userAttribute.value,\n    } as FilterASTNode\n  }\n  return node\n}\n\n/**\n * Traverses ast and updates userAttribute value\n */\nexport const userAttributeTransform =\n  (userAttributes?: UserAttributeWithValue[]) =>\n  (root: FilterASTNode): FilterASTNode => {\n    if (!userAttributes || !userAttributes.length) return root\n\n    const workingRoot = updateAttributeValue(root, userAttributes)\n    let pointer = workingRoot\n    while (pointer.right) {\n      pointer.left =\n        pointer.left && updateAttributeValue(pointer.left, userAttributes)\n      pointer.right = updateAttributeValue(pointer.right, userAttributes)\n      pointer = pointer.right\n    }\n    return workingRoot\n  }\n"],"mappings":";;;;;;;;AAKA;AACA;AAAqD;AAAA;AAKrD,IAAMA,oBAAoB,GAAG,SAAvBA,oBAAoB,CACxBC,IAAmB,EACnBC,cAAwC,EACtB;EAClB,IAAID,IAAI,IAAIA,IAAI,CAACE,IAAI,KAAKC,0BAAmB,EAAE;IAC7C,IAAMC,aAAa,GAAG,IAAAC,iCAAiB,EAACL,IAAI,CAACM,aAAa,EAAEL,cAAc,CAAC;IAC3E,uCACKD,IAAI;MACPO,cAAc,EAAEH,aAAa,IAAIA,aAAa,CAACI;IAAK;EAExD;EACA,OAAOR,IAAI;AACb,CAAC;;AAKM,IAAMS,sBAAsB,GACjC,SADWA,sBAAsB,CAChCR,cAAyC;EAAA,OAC1C,UAACS,IAAmB,EAAoB;IACtC,IAAI,CAACT,cAAc,IAAI,CAACA,cAAc,CAACU,MAAM,EAAE,OAAOD,IAAI;IAE1D,IAAME,WAAW,GAAGb,oBAAoB,CAACW,IAAI,EAAET,cAAc,CAAC;IAC9D,IAAIY,OAAO,GAAGD,WAAW;IACzB,OAAOC,OAAO,CAACC,KAAK,EAAE;MACpBD,OAAO,CAACE,IAAI,GACVF,OAAO,CAACE,IAAI,IAAIhB,oBAAoB,CAACc,OAAO,CAACE,IAAI,EAAEd,cAAc,CAAC;MACpEY,OAAO,CAACC,KAAK,GAAGf,oBAAoB,CAACc,OAAO,CAACC,KAAK,EAAEb,cAAc,CAAC;MACnEY,OAAO,GAAGA,OAAO,CAACC,KAAK;IACzB;IACA,OAAOF,WAAW;EACpB,CAAC;AAAA;AAAA"}