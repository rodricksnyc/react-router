{"version":3,"file":"userAttributeTransform.js","names":["TYPE_USER_ATTRIBUTE","findUserAttribute","updateAttributeValue","node","userAttributes","type","userAttribute","attributeName","attributeValue","value","userAttributeTransform","root","length","workingRoot","pointer","right","left"],"sources":["../../../../src/utils/transform/userAttributeTransform.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\nimport type { FilterASTNode, UserAttributeWithValue } from '../../types'\nimport { TYPE_USER_ATTRIBUTE } from '../../types'\nimport { findUserAttribute } from '../user_attribute'\n\n/**\n * sets the userAttributeValue on a node with type 'user_attribute'\n */\nconst updateAttributeValue = (\n  node: FilterASTNode,\n  userAttributes: UserAttributeWithValue[]\n): FilterASTNode => {\n  if (node && node.type === TYPE_USER_ATTRIBUTE) {\n    const userAttribute = findUserAttribute(node.attributeName, userAttributes)\n    return {\n      ...node,\n      attributeValue: userAttribute && userAttribute.value,\n    } as FilterASTNode\n  }\n  return node\n}\n\n/**\n * Traverses ast and updates userAttribute value\n */\nexport const userAttributeTransform =\n  (userAttributes?: UserAttributeWithValue[]) =>\n  (root: FilterASTNode): FilterASTNode => {\n    if (!userAttributes || !userAttributes.length) return root\n\n    const workingRoot = updateAttributeValue(root, userAttributes)\n    let pointer = workingRoot\n    while (pointer.right) {\n      pointer.left =\n        pointer.left && updateAttributeValue(pointer.left, userAttributes)\n      pointer.right = updateAttributeValue(pointer.right, userAttributes)\n      pointer = pointer.right\n    }\n    return workingRoot\n  }\n"],"mappings":";;;;AAKA,SAASA,mBAAmB,QAAQ,aAAa;AACjD,SAASC,iBAAiB,QAAQ,mBAAmB;;AAKrD,MAAMC,oBAAoB,GAAG,CAC3BC,IAAmB,EACnBC,cAAwC,KACtB;EAClB,IAAID,IAAI,IAAIA,IAAI,CAACE,IAAI,KAAKL,mBAAmB,EAAE;IAC7C,MAAMM,aAAa,GAAGL,iBAAiB,CAACE,IAAI,CAACI,aAAa,EAAEH,cAAc,CAAC;IAC3E,uCACKD,IAAI;MACPK,cAAc,EAAEF,aAAa,IAAIA,aAAa,CAACG;IAAK;EAExD;EACA,OAAON,IAAI;AACb,CAAC;;AAKD,OAAO,MAAMO,sBAAsB,GAChCN,cAAyC,IACzCO,IAAmB,IAAoB;EACtC,IAAI,CAACP,cAAc,IAAI,CAACA,cAAc,CAACQ,MAAM,EAAE,OAAOD,IAAI;EAE1D,MAAME,WAAW,GAAGX,oBAAoB,CAACS,IAAI,EAAEP,cAAc,CAAC;EAC9D,IAAIU,OAAO,GAAGD,WAAW;EACzB,OAAOC,OAAO,CAACC,KAAK,EAAE;IACpBD,OAAO,CAACE,IAAI,GACVF,OAAO,CAACE,IAAI,IAAId,oBAAoB,CAACY,OAAO,CAACE,IAAI,EAAEZ,cAAc,CAAC;IACpEU,OAAO,CAACC,KAAK,GAAGb,oBAAoB,CAACY,OAAO,CAACC,KAAK,EAAEX,cAAc,CAAC;IACnEU,OAAO,GAAGA,OAAO,CAACC,KAAK;EACzB;EACA,OAAOF,WAAW;AACpB,CAAC"}