{"version":3,"file":"seriesCellVis.js","names":["setSeriesCellVisStatus","config","measureName","i","cellVisDefault","seriesBaseName","split","apiValue","get","seriesCellVis","data","fields","series","restConfig","buildArraySeries","s","arraySeries","measures","map","name","defaultSeriesCellValue","cell_visualization","restSeries","buildNamedSeries","namedSeries","reduce","seriesConfig","Array","isArray"],"sources":["../../../src/configTransformations/seriesCellVis.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\n\nimport get from 'lodash/get'\nimport type { CTable, CTableSeries } from '../adapters'\nimport type { ConfigHelper, ConfigHelperArgs } from '../types'\n\ntype ApiConfigWithOverrides = ConfigHelperArgs<CTable>['config']\n\nconst setSeriesCellVisStatus = (\n  config: ApiConfigWithOverrides,\n  measureName = '',\n  i: number\n) => {\n  const cellVisDefault = i === 0\n  const seriesBaseName = measureName.split('|')[0] // isolated value relevant to pivoted queries\n  const apiValue = get(\n    config,\n    ['series_cell_visualizations', seriesBaseName, 'is_active'],\n    cellVisDefault\n  )\n  return apiValue\n}\n\nexport const seriesCellVis: ConfigHelper<CTable> = ({\n  config,\n  data,\n  fields,\n}) => {\n  const { series = {}, ...restConfig } = config\n\n  const buildArraySeries = (s: CTableSeries[] = []) => {\n    const arraySeries = fields?.measures.map(({ name }, i) => {\n      const defaultSeriesCellValue = setSeriesCellVisStatus(config, name, i)\n      const { cell_visualization = defaultSeriesCellValue, ...restSeries } =\n        s?.[i] || {}\n      return { cell_visualization, ...restSeries }\n    }, [])\n    return arraySeries\n  }\n\n  const buildNamedSeries = (s: { [k: string]: CTableSeries } = {}) => {\n    const namedSeries = fields.measures.reduce(\n      (seriesConfig, { name }, i) => {\n        const defaultSeriesCellValue = setSeriesCellVisStatus(config, name, i)\n        const { cell_visualization = defaultSeriesCellValue, ...restSeries } =\n          s?.[name] || {}\n        return {\n          ...seriesConfig,\n          [name]: { cell_visualization, ...restSeries },\n        }\n      },\n\n      {}\n    )\n    return namedSeries\n  }\n\n  return {\n    config: {\n      series: Array.isArray(series)\n        ? buildArraySeries(series)\n        : buildNamedSeries(series),\n      ...restConfig,\n    },\n    data,\n    fields,\n  }\n}\n"],"mappings":";;;;;;;;;AAKA;AAA4B;EAAA;EAAA;AAAA;AAAA;AAM5B,IAAMA,sBAAsB,GAAG,SAAzBA,sBAAsB,CAC1BC,MAA8B,EAG3B;EAAA,IAFHC,WAAW,uEAAG,EAAE;EAAA,IAChBC,CAAS;EAET,IAAMC,cAAc,GAAGD,CAAC,KAAK,CAAC;EAC9B,IAAME,cAAc,GAAGH,WAAW,CAACI,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;EAChD,IAAMC,QAAQ,GAAG,IAAAC,eAAG,EAClBP,MAAM,EACN,CAAC,4BAA4B,EAAEI,cAAc,EAAE,WAAW,CAAC,EAC3DD,cAAc,CACf;EACD,OAAOG,QAAQ;AACjB,CAAC;AAEM,IAAME,aAAmC,GAAG,SAAtCA,aAAmC,OAI1C;EAAA,IAHJR,MAAM,QAANA,MAAM;IACNS,IAAI,QAAJA,IAAI;IACJC,MAAM,QAANA,MAAM;EAEN,qBAAuCV,MAAM,CAArCW,MAAM;IAANA,MAAM,+BAAG,CAAC,CAAC;IAAKC,UAAU,6CAAKZ,MAAM;EAE7C,IAAMa,gBAAgB,GAAG,SAAnBA,gBAAgB,GAA+B;IAAA,IAA3BC,CAAiB,uEAAG,EAAE;IAC9C,IAAMC,WAAW,GAAGL,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEM,QAAQ,CAACC,GAAG,CAAC,iBAAWf,CAAC,EAAK;MAAA,IAAdgB,IAAI,SAAJA,IAAI;MAC9C,IAAMC,sBAAsB,GAAGpB,sBAAsB,CAACC,MAAM,EAAEkB,IAAI,EAAEhB,CAAC,CAAC;MACtE,YACE,CAAAY,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAGZ,CAAC,CAAC,KAAI,CAAC,CAAC;QAAA,8BADNkB,kBAAkB;QAAlBA,kBAAkB,sCAAGD,sBAAsB;QAAKE,UAAU;MAElE;QAASD,kBAAkB,EAAlBA;MAAkB,GAAKC,UAAU;IAC5C,CAAC,EAAE,EAAE,CAAC;IACN,OAAON,WAAW;EACpB,CAAC;EAED,IAAMO,gBAAgB,GAAG,SAAnBA,gBAAgB,GAA8C;IAAA,IAA1CR,CAAgC,uEAAG,CAAC,CAAC;IAC7D,IAAMS,WAAW,GAAGb,MAAM,CAACM,QAAQ,CAACQ,MAAM,CACxC,UAACC,YAAY,SAAYvB,CAAC,EAAK;MAAA,IAAdgB,IAAI,SAAJA,IAAI;MACnB,IAAMC,sBAAsB,GAAGpB,sBAAsB,CAACC,MAAM,EAAEkB,IAAI,EAAEhB,CAAC,CAAC;MACtE,YACE,CAAAY,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAGI,IAAI,CAAC,KAAI,CAAC,CAAC;QAAA,8BADTE,kBAAkB;QAAlBA,kBAAkB,sCAAGD,sBAAsB;QAAKE,UAAU;MAElE,uCACKI,YAAY,4CACdP,IAAI;QAAKE,kBAAkB,EAAlBA;MAAkB,GAAKC,UAAU;IAE/C,CAAC,EAED,CAAC,CAAC,CACH;IACD,OAAOE,WAAW;EACpB,CAAC;EAED,OAAO;IACLvB,MAAM;MACJW,MAAM,EAAEe,KAAK,CAACC,OAAO,CAAChB,MAAM,CAAC,GACzBE,gBAAgB,CAACF,MAAM,CAAC,GACxBW,gBAAgB,CAACX,MAAM;IAAC,GACzBC,UAAU,CACd;IACDH,IAAI,EAAJA,IAAI;IACJC,MAAM,EAANA;EACF,CAAC;AACH,CAAC;AAAA"}