{"version":3,"file":"seriesValueFormat.js","names":["seriesValueFormat","config","fields","data","series","value_format","label_value_format","series_value_format","restConfig","valueFormat","buildArraySeries","s","arraySeries","defaultValues","measures","map","measure","get","name","DEFAULT_STRING_FORMAT","i","length","Object","assign","buildNamedSeries","namedSeries","reduce","seriesConfig","currentFieldSettings","pick","seriesValueFormatString","measureValueFormat","defaultValueFormat","merge","Array","isArray"],"sources":["../../../src/configTransformations/seriesValueFormat.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\n\nimport type {\n  ConfigHelper,\n  CSeriesBasic,\n  CommonCartesianProperties,\n} from '../types'\nimport merge from 'lodash/merge'\nimport pick from 'lodash/pick'\nimport get from 'lodash/get'\nimport { DEFAULT_STRING_FORMAT } from '../utils/constants'\n\nexport const seriesValueFormat: ConfigHelper<CommonCartesianProperties> = ({\n  config,\n  fields,\n  data,\n}) => {\n  const {\n    series = {},\n    value_format,\n    label_value_format,\n    series_value_format = {},\n    ...restConfig\n  } = config\n  const valueFormat = value_format || label_value_format\n\n  const buildArraySeries = (s: CSeriesBasic[] = []) => {\n    const arraySeries = [...s]\n    const defaultValues = fields?.measures?.map((measure) => ({\n      value_format:\n        get(series_value_format, [measure.name, 'format_string']) ||\n        get(measure, 'value_format') ||\n        valueFormat ||\n        DEFAULT_STRING_FORMAT,\n    }))\n    for (let i = 0; i < defaultValues?.length; i++) {\n      arraySeries[i] = Object.assign({}, defaultValues[i], arraySeries[i])\n    }\n    return arraySeries\n  }\n\n  const buildNamedSeries = (s: { [k: string]: CSeriesBasic }) => {\n    const namedSeries = fields?.measures?.reduce((seriesConfig, measure) => {\n      const { name } = measure\n      const currentFieldSettings = pick(s, name)\n      const seriesValueFormatString = get(series_value_format, [\n        name,\n        'format_string',\n      ])\n      const measureValueFormat = get(measure, 'value_format')\n      const defaultValueFormat = {\n        [name]: {\n          value_format:\n            seriesValueFormatString ||\n            measureValueFormat ||\n            valueFormat ||\n            DEFAULT_STRING_FORMAT,\n        },\n      }\n      return merge(seriesConfig, defaultValueFormat, currentFieldSettings)\n    }, {} as { [key: string]: CSeriesBasic })\n    return namedSeries\n  }\n\n  return {\n    config: {\n      series: Array.isArray(series)\n        ? buildArraySeries(series)\n        : buildNamedSeries(series),\n      ...restConfig,\n    },\n    fields,\n    data,\n  }\n}\n"],"mappings":";;;;;;;;;;AAUA;AACA;AACA;AACA;AAA0D;AAAA;AAAA;AAEnD,IAAMA,iBAA0D,GAAG,SAA7DA,iBAA0D,OAIjE;EAAA,IAHJC,MAAM,QAANA,MAAM;IACNC,MAAM,QAANA,MAAM;IACNC,IAAI,QAAJA,IAAI;EAEJ,qBAMIF,MAAM,CALRG,MAAM;IAANA,MAAM,+BAAG,CAAC,CAAC;IACXC,YAAY,GAIVJ,MAAM,CAJRI,YAAY;IACZC,kBAAkB,GAGhBL,MAAM,CAHRK,kBAAkB;IAAA,wBAGhBL,MAAM,CAFRM,mBAAmB;IAAnBA,mBAAmB,sCAAG,CAAC,CAAC;IACrBC,UAAU,6CACXP,MAAM;EACV,IAAMQ,WAAW,GAAGJ,YAAY,IAAIC,kBAAkB;EAEtD,IAAMI,gBAAgB,GAAG,SAAnBA,gBAAgB,GAA+B;IAAA;IAAA,IAA3BC,CAAiB,uEAAG,EAAE;IAC9C,IAAMC,WAAW,uCAAOD,CAAC,CAAC;IAC1B,IAAME,aAAa,GAAGX,MAAM,aAANA,MAAM,2CAANA,MAAM,CAAEY,QAAQ,qDAAhB,iBAAkBC,GAAG,CAAC,UAACC,OAAO;MAAA,OAAM;QACxDX,YAAY,EACV,IAAAY,eAAG,EAACV,mBAAmB,EAAE,CAACS,OAAO,CAACE,IAAI,EAAE,eAAe,CAAC,CAAC,IACzD,IAAAD,eAAG,EAACD,OAAO,EAAE,cAAc,CAAC,IAC5BP,WAAW,IACXU;MACJ,CAAC;IAAA,CAAC,CAAC;IACH,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,IAAGP,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEQ,MAAM,GAAED,CAAC,EAAE,EAAE;MAC9CR,WAAW,CAACQ,CAAC,CAAC,GAAGE,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAEV,aAAa,CAACO,CAAC,CAAC,EAAER,WAAW,CAACQ,CAAC,CAAC,CAAC;IACtE;IACA,OAAOR,WAAW;EACpB,CAAC;EAED,IAAMY,gBAAgB,GAAG,SAAnBA,gBAAgB,CAAIb,CAAgC,EAAK;IAAA;IAC7D,IAAMc,WAAW,GAAGvB,MAAM,aAANA,MAAM,4CAANA,MAAM,CAAEY,QAAQ,sDAAhB,kBAAkBY,MAAM,CAAC,UAACC,YAAY,EAAEX,OAAO,EAAK;MACtE,IAAQE,IAAI,GAAKF,OAAO,CAAhBE,IAAI;MACZ,IAAMU,oBAAoB,GAAG,IAAAC,gBAAI,EAAClB,CAAC,EAAEO,IAAI,CAAC;MAC1C,IAAMY,uBAAuB,GAAG,IAAAb,eAAG,EAACV,mBAAmB,EAAE,CACvDW,IAAI,EACJ,eAAe,CAChB,CAAC;MACF,IAAMa,kBAAkB,GAAG,IAAAd,eAAG,EAACD,OAAO,EAAE,cAAc,CAAC;MACvD,IAAMgB,kBAAkB,wCACrBd,IAAI,EAAG;QACNb,YAAY,EACVyB,uBAAuB,IACvBC,kBAAkB,IAClBtB,WAAW,IACXU;MACJ,CAAC,CACF;MACD,OAAO,IAAAc,iBAAK,EAACN,YAAY,EAAEK,kBAAkB,EAAEJ,oBAAoB,CAAC;IACtE,CAAC,EAAE,CAAC,CAAC,CAAoC;IACzC,OAAOH,WAAW;EACpB,CAAC;EAED,OAAO;IACLxB,MAAM;MACJG,MAAM,EAAE8B,KAAK,CAACC,OAAO,CAAC/B,MAAM,CAAC,GACzBM,gBAAgB,CAACN,MAAM,CAAC,GACxBoB,gBAAgB,CAACpB,MAAM;IAAC,GACzBI,UAAU,CACd;IACDN,MAAM,EAANA,MAAM;IACNC,IAAI,EAAJA;EACF,CAAC;AACH,CAAC;AAAA"}