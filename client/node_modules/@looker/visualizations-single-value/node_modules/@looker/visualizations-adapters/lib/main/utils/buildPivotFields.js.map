{"version":3,"file":"buildPivotFields.js","names":["buildPivotFields","fields","pivots","fieldsCopy","measures","flatMap","key","pivotLabel","label","map","measureField","pivotMeasureName","buildPivotMeasureName","measureName","name","pivotValue","label_short","pivot_key","pivoted_label"],"sources":["../../../src/utils/buildPivotFields.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\n\nimport type { MeasureMetadata, Fields, Pivots } from '../types'\nimport { buildPivotMeasureName } from '.'\n\n/**\n * Creates a new fields metadata object, replacing the existing fields.measures\n * property with pivot metadata objects. These pivot metadata objects are identical\n * to normal measure metadata objects from the Looker SDK, but use the query's\n * pivot values to derive their label, key and other relevant metadata.\n */\nexport const buildPivotFields = ({\n  fields,\n  pivots,\n}: {\n  fields: Fields\n  pivots: Pivots\n}) => {\n  const fieldsCopy = {\n    ...fields,\n    pivots: [...(fields?.pivots || [])],\n  }\n\n  fieldsCopy.measures = pivots.flatMap(({ key, label: pivotLabel }) => {\n    return fields.measures.map((measureField) => {\n      const pivotMeasureName = buildPivotMeasureName({\n        measureName: measureField.name,\n        pivotValue: key,\n      })\n\n      return {\n        ...measureField,\n        label_short: pivotLabel,\n        name: pivotMeasureName,\n        pivot_key: key,\n        pivoted_label: `${measureField.label}: ${pivotLabel}`,\n      } as MeasureMetadata\n    })\n  })\n\n  return fieldsCopy\n}\n"],"mappings":";;;;;;;;;AAMA;AAAyC;AAAA;AAQlC,IAAMA,gBAAgB,GAAG,SAAnBA,gBAAgB,OAMvB;EAAA,IALJC,MAAM,QAANA,MAAM;IACNC,MAAM,QAANA,MAAM;EAKN,IAAMC,UAAU,mCACXF,MAAM;IACTC,MAAM,sCAAO,CAAAD,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEC,MAAM,KAAI,EAAE;EAAE,EACpC;EAEDC,UAAU,CAACC,QAAQ,GAAGF,MAAM,CAACG,OAAO,CAAC,iBAAgC;IAAA,IAA7BC,GAAG,SAAHA,GAAG;MAASC,UAAU,SAAjBC,KAAK;IAChD,OAAOP,MAAM,CAACG,QAAQ,CAACK,GAAG,CAAC,UAACC,YAAY,EAAK;MAC3C,IAAMC,gBAAgB,GAAG,IAAAC,uBAAqB,EAAC;QAC7CC,WAAW,EAAEH,YAAY,CAACI,IAAI;QAC9BC,UAAU,EAAET;MACd,CAAC,CAAC;MAEF,uCACKI,YAAY;QACfM,WAAW,EAAET,UAAU;QACvBO,IAAI,EAAEH,gBAAgB;QACtBM,SAAS,EAAEX,GAAG;QACdY,aAAa,YAAKR,YAAY,CAACF,KAAK,eAAKD,UAAU;MAAE;IAEzD,CAAC,CAAC;EACJ,CAAC,CAAC;EAEF,OAAOJ,UAAU;AACnB,CAAC;AAAA"}