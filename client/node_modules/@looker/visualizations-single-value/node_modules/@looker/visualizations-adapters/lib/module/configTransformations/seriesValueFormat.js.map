{"version":3,"file":"seriesValueFormat.js","names":["merge","pick","get","DEFAULT_STRING_FORMAT","seriesValueFormat","config","fields","data","series","value_format","label_value_format","series_value_format","restConfig","valueFormat","buildArraySeries","s","arraySeries","defaultValues","measures","map","measure","name","i","length","Object","assign","buildNamedSeries","namedSeries","reduce","seriesConfig","currentFieldSettings","seriesValueFormatString","measureValueFormat","defaultValueFormat","Array","isArray"],"sources":["../../../src/configTransformations/seriesValueFormat.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\n\nimport type {\n  ConfigHelper,\n  CSeriesBasic,\n  CommonCartesianProperties,\n} from '../types'\nimport merge from 'lodash/merge'\nimport pick from 'lodash/pick'\nimport get from 'lodash/get'\nimport { DEFAULT_STRING_FORMAT } from '../utils/constants'\n\nexport const seriesValueFormat: ConfigHelper<CommonCartesianProperties> = ({\n  config,\n  fields,\n  data,\n}) => {\n  const {\n    series = {},\n    value_format,\n    label_value_format,\n    series_value_format = {},\n    ...restConfig\n  } = config\n  const valueFormat = value_format || label_value_format\n\n  const buildArraySeries = (s: CSeriesBasic[] = []) => {\n    const arraySeries = [...s]\n    const defaultValues = fields?.measures?.map((measure) => ({\n      value_format:\n        get(series_value_format, [measure.name, 'format_string']) ||\n        get(measure, 'value_format') ||\n        valueFormat ||\n        DEFAULT_STRING_FORMAT,\n    }))\n    for (let i = 0; i < defaultValues?.length; i++) {\n      arraySeries[i] = Object.assign({}, defaultValues[i], arraySeries[i])\n    }\n    return arraySeries\n  }\n\n  const buildNamedSeries = (s: { [k: string]: CSeriesBasic }) => {\n    const namedSeries = fields?.measures?.reduce((seriesConfig, measure) => {\n      const { name } = measure\n      const currentFieldSettings = pick(s, name)\n      const seriesValueFormatString = get(series_value_format, [\n        name,\n        'format_string',\n      ])\n      const measureValueFormat = get(measure, 'value_format')\n      const defaultValueFormat = {\n        [name]: {\n          value_format:\n            seriesValueFormatString ||\n            measureValueFormat ||\n            valueFormat ||\n            DEFAULT_STRING_FORMAT,\n        },\n      }\n      return merge(seriesConfig, defaultValueFormat, currentFieldSettings)\n    }, {} as { [key: string]: CSeriesBasic })\n    return namedSeries\n  }\n\n  return {\n    config: {\n      series: Array.isArray(series)\n        ? buildArraySeries(series)\n        : buildNamedSeries(series),\n      ...restConfig,\n    },\n    fields,\n    data,\n  }\n}\n"],"mappings":";;;;;;AAUA,OAAOA,KAAK,MAAM,cAAc;AAChC,OAAOC,IAAI,MAAM,aAAa;AAC9B,OAAOC,GAAG,MAAM,YAAY;AAC5B,SAASC,qBAAqB,QAAQ,oBAAoB;AAE1D,OAAO,MAAMC,iBAA0D,GAAG,CAAC;EACzEC,MAAM;EACNC,MAAM;EACNC;AACF,CAAC,KAAK;EACJ,MAAM;MACJC,MAAM,GAAG,CAAC,CAAC;MACXC,YAAY;MACZC,kBAAkB;MAClBC,mBAAmB,GAAG,CAAC;IAEzB,CAAC,GAAGN,MAAM;IADLO,UAAU,4BACXP,MAAM;EACV,MAAMQ,WAAW,GAAGJ,YAAY,IAAIC,kBAAkB;EAEtD,MAAMI,gBAAgB,GAAG,CAACC,CAAiB,GAAG,EAAE,KAAK;IAAA;IACnD,MAAMC,WAAW,GAAG,CAAC,GAAGD,CAAC,CAAC;IAC1B,MAAME,aAAa,GAAGX,MAAM,aAANA,MAAM,2CAANA,MAAM,CAAEY,QAAQ,qDAAhB,iBAAkBC,GAAG,CAAEC,OAAO,KAAM;MACxDX,YAAY,EACVP,GAAG,CAACS,mBAAmB,EAAE,CAACS,OAAO,CAACC,IAAI,EAAE,eAAe,CAAC,CAAC,IACzDnB,GAAG,CAACkB,OAAO,EAAE,cAAc,CAAC,IAC5BP,WAAW,IACXV;IACJ,CAAC,CAAC,CAAC;IACH,KAAK,IAAImB,CAAC,GAAG,CAAC,EAAEA,CAAC,IAAGL,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEM,MAAM,GAAED,CAAC,EAAE,EAAE;MAC9CN,WAAW,CAACM,CAAC,CAAC,GAAGE,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAER,aAAa,CAACK,CAAC,CAAC,EAAEN,WAAW,CAACM,CAAC,CAAC,CAAC;IACtE;IACA,OAAON,WAAW;EACpB,CAAC;EAED,MAAMU,gBAAgB,GAAIX,CAAgC,IAAK;IAAA;IAC7D,MAAMY,WAAW,GAAGrB,MAAM,aAANA,MAAM,4CAANA,MAAM,CAAEY,QAAQ,sDAAhB,kBAAkBU,MAAM,CAAC,CAACC,YAAY,EAAET,OAAO,KAAK;MACtE,MAAM;QAAEC;MAAK,CAAC,GAAGD,OAAO;MACxB,MAAMU,oBAAoB,GAAG7B,IAAI,CAACc,CAAC,EAAEM,IAAI,CAAC;MAC1C,MAAMU,uBAAuB,GAAG7B,GAAG,CAACS,mBAAmB,EAAE,CACvDU,IAAI,EACJ,eAAe,CAChB,CAAC;MACF,MAAMW,kBAAkB,GAAG9B,GAAG,CAACkB,OAAO,EAAE,cAAc,CAAC;MACvD,MAAMa,kBAAkB,GAAG;QACzB,CAACZ,IAAI,GAAG;UACNZ,YAAY,EACVsB,uBAAuB,IACvBC,kBAAkB,IAClBnB,WAAW,IACXV;QACJ;MACF,CAAC;MACD,OAAOH,KAAK,CAAC6B,YAAY,EAAEI,kBAAkB,EAAEH,oBAAoB,CAAC;IACtE,CAAC,EAAE,CAAC,CAAC,CAAoC;IACzC,OAAOH,WAAW;EACpB,CAAC;EAED,OAAO;IACLtB,MAAM;MACJG,MAAM,EAAE0B,KAAK,CAACC,OAAO,CAAC3B,MAAM,CAAC,GACzBM,gBAAgB,CAACN,MAAM,CAAC,GACxBkB,gBAAgB,CAAClB,MAAM;IAAC,GACzBI,UAAU,CACd;IACDN,MAAM;IACNC;EACF,CAAC;AACH,CAAC"}