{"version":3,"file":"buildChartConfig.js","names":["normalizeChartTypes","chartConfigByType","sanitizeSDKResponse","flow","buildChartConfig","args","isDataValid","data","length","fields","measures","config","type","configTransformations","default"],"sources":["../../../src/utils/buildChartConfig.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\nimport {\n  normalizeChartTypes,\n  chartConfigByType,\n  sanitizeSDKResponse,\n} from '../configTransformations'\nimport flow from 'lodash/flow'\nimport type {\n  ConfigHelperArgs,\n  CAll,\n  RawApiConfigResponse,\n  Fields,\n  SDKRecord,\n  SupportedChartTypes,\n} from '../types'\n\ntype ChartConfigArgs = {\n  config: Partial<CAll> | Partial<RawApiConfigResponse>\n  data?: SDKRecord[]\n  fields?: Fields\n}\n\n/**\n * Utility function builds and sanitizes the public config object from\n * the provided raw sdk response and selected transformations.\n * @param config vis config as it comes unsanitized from sdk\n * @param data query response\n * @param fields metadata describing fields and dimensions from query\n * @returns\n */\nexport const buildChartConfig = (args: ChartConfigArgs) => {\n  const isDataValid = args.data?.length && args.fields?.measures?.length\n\n  const { config } = flow([\n    normalizeChartTypes,\n    (args: ConfigHelperArgs<CAll>) => {\n      const { type } = args.config\n\n      const configTransformations =\n        chartConfigByType[type as keyof SupportedChartTypes] ||\n        chartConfigByType.default\n\n      if (isDataValid) {\n        // if necessary data is present, run transformations\n        return flow(configTransformations)(args)\n      } else {\n        // if no data or fields, simply pass through unmodified results at this point\n        return args\n      }\n    },\n    sanitizeSDKResponse,\n  ])(args)\n\n  return config\n}\n"],"mappings":";AAIA,SACEA,mBAAmB,EACnBC,iBAAiB,EACjBC,mBAAmB,QACd,0BAA0B;AACjC,OAAOC,IAAI,MAAM,aAAa;AAwB9B,OAAO,MAAMC,gBAAgB,GAAIC,IAAqB,IAAK;EAAA;EACzD,MAAMC,WAAW,GAAG,eAAAD,IAAI,CAACE,IAAI,+CAAT,WAAWC,MAAM,sBAAIH,IAAI,CAACI,MAAM,0EAAX,aAAaC,QAAQ,0DAArB,sBAAuBF,MAAM;EAEtE,MAAM;IAAEG;EAAO,CAAC,GAAGR,IAAI,CAAC,CACtBH,mBAAmB,EAClBK,IAA4B,IAAK;IAChC,MAAM;MAAEO;IAAK,CAAC,GAAGP,IAAI,CAACM,MAAM;IAE5B,MAAME,qBAAqB,GACzBZ,iBAAiB,CAACW,IAAI,CAA8B,IACpDX,iBAAiB,CAACa,OAAO;IAE3B,IAAIR,WAAW,EAAE;MAEf,OAAOH,IAAI,CAACU,qBAAqB,CAAC,CAACR,IAAI,CAAC;IAC1C,CAAC,MAAM;MAEL,OAAOA,IAAI;IACb;EACF,CAAC,EACDH,mBAAmB,CACpB,CAAC,CAACG,IAAI,CAAC;EAER,OAAOM,MAAM;AACf,CAAC"}