{"version":3,"file":"buildPivotFields.js","names":["buildPivotMeasureName","buildPivotFields","fields","pivots","fieldsCopy","measures","flatMap","key","label","pivotLabel","map","measureField","pivotMeasureName","measureName","name","pivotValue","label_short","pivot_key","pivoted_label"],"sources":["../../../src/utils/buildPivotFields.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\n\nimport type { MeasureMetadata, Fields, Pivots } from '../types'\nimport { buildPivotMeasureName } from '.'\n\n/**\n * Creates a new fields metadata object, replacing the existing fields.measures\n * property with pivot metadata objects. These pivot metadata objects are identical\n * to normal measure metadata objects from the Looker SDK, but use the query's\n * pivot values to derive their label, key and other relevant metadata.\n */\nexport const buildPivotFields = ({\n  fields,\n  pivots,\n}: {\n  fields: Fields\n  pivots: Pivots\n}) => {\n  const fieldsCopy = {\n    ...fields,\n    pivots: [...(fields?.pivots || [])],\n  }\n\n  fieldsCopy.measures = pivots.flatMap(({ key, label: pivotLabel }) => {\n    return fields.measures.map((measureField) => {\n      const pivotMeasureName = buildPivotMeasureName({\n        measureName: measureField.name,\n        pivotValue: key,\n      })\n\n      return {\n        ...measureField,\n        label_short: pivotLabel,\n        name: pivotMeasureName,\n        pivot_key: key,\n        pivoted_label: `${measureField.label}: ${pivotLabel}`,\n      } as MeasureMetadata\n    })\n  })\n\n  return fieldsCopy\n}\n"],"mappings":";;;;AAMA,SAASA,qBAAqB,QAAQ,GAAG;;AAQzC,OAAO,MAAMC,gBAAgB,GAAG,CAAC;EAC/BC,MAAM;EACNC;AAIF,CAAC,KAAK;EACJ,MAAMC,UAAU,mCACXF,MAAM;IACTC,MAAM,EAAE,CAAC,IAAI,CAAAD,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEC,MAAM,KAAI,EAAE,CAAC;EAAC,EACpC;EAEDC,UAAU,CAACC,QAAQ,GAAGF,MAAM,CAACG,OAAO,CAAC,CAAC;IAAEC,GAAG;IAAEC,KAAK,EAAEC;EAAW,CAAC,KAAK;IACnE,OAAOP,MAAM,CAACG,QAAQ,CAACK,GAAG,CAAEC,YAAY,IAAK;MAC3C,MAAMC,gBAAgB,GAAGZ,qBAAqB,CAAC;QAC7Ca,WAAW,EAAEF,YAAY,CAACG,IAAI;QAC9BC,UAAU,EAAER;MACd,CAAC,CAAC;MAEF,uCACKI,YAAY;QACfK,WAAW,EAAEP,UAAU;QACvBK,IAAI,EAAEF,gBAAgB;QACtBK,SAAS,EAAEV,GAAG;QACdW,aAAa,EAAG,GAAEP,YAAY,CAACH,KAAM,KAAIC,UAAW;MAAC;IAEzD,CAAC,CAAC;EACJ,CAAC,CAAC;EAEF,OAAOL,UAAU;AACnB,CAAC"}